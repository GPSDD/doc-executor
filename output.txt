Running Start

> doc-writer@1.0.0 start /opt/doc-executor
> NODE_PATH=app/src node app/index.js

{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Initializing doc-executor","time":"2018-10-16T17:23:55.024Z","src":{"file":"/opt/doc-executor/app/src/app.js","line":3},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":30,"msg":"Connecting to queue DOC-STATUS","time":"2018-10-16T17:23:55.091Z","src":{"file":"/opt/doc-executor/app/src/services/status-queue.service.js","line":13,"func":"StatusQueueService"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":30,"msg":"Connecting to queue DOC-DATA","time":"2018-10-16T17:23:55.420Z","src":{"file":"/opt/doc-executor/app/src/services/data-queue.service.js","line":17,"func":"DataQueueService"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":30,"msg":"Connecting to queue DOC-EXECUTOR-TASKS","time":"2018-10-16T17:23:55.651Z","src":{"file":"/opt/doc-executor/app/src/services/executor-queue.service.js","line":20,"func":"ExecutorQueueService"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":30,"msg":"Connected","time":"2018-10-16T17:23:55.719Z","src":{"file":"/opt/doc-executor/app/src/services/status-queue.service.js","line":16,"func":"StatusQueueService.init.then"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":30,"msg":"Connected","time":"2018-10-16T17:23:55.719Z","src":{"file":"/opt/doc-executor/app/src/services/data-queue.service.js","line":20,"func":"DataQueueService.init.then"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":30,"msg":" [*] Waiting for messages in DOC-EXECUTOR-TASKS","time":"2018-10-16T17:23:55.721Z","src":{"file":"/opt/doc-executor/app/src/services/executor-queue.service.js","line":40,"func":"init"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":30,"msg":"Connected","time":"2018-10-16T17:23:55.721Z","src":{"file":"/opt/doc-executor/app/src/services/executor-queue.service.js","line":23,"func":"ExecutorQueueService.init.then"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Message received {\"id\":\"61145133-291a-418a-8079-776fad4f6626\",\"type\":\"EXECUTION_CREATE\",\"taskId\":\"2f533c51-9e8d-4bcf-9c9c-06db2392d463\",\"datasetId\":\"b00bd944-88c6-4f75-bae7-ec0bf0fd39d7\",\"fileUrl\":\"https://www.apihighways.org/static/hxl.csv\",\"provider\":\"csv\",\"legend\":{\"nested\":[],\"country\":[],\"region\":[],\"date\":[]},\"verified\":false,\"dataPath\":null}","time":"2018-10-16T17:37:37.315Z","src":{"file":"/opt/doc-executor/app/src/services/executor-queue.service.js","line":66,"func":"consume"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"message content { id: '61145133-291a-418a-8079-776fad4f6626',\n  type: 'EXECUTION_CREATE',\n  taskId: '2f533c51-9e8d-4bcf-9c9c-06db2392d463',\n  datasetId: 'b00bd944-88c6-4f75-bae7-ec0bf0fd39d7',\n  fileUrl: 'https://www.apihighways.org/static/hxl.csv',\n  provider: 'csv',\n  legend: { nested: [], country: [], region: [], date: [] },\n  verified: false,\n  dataPath: null }","time":"2018-10-16T17:37:37.315Z","src":{"file":"/opt/doc-executor/app/src/services/executor-queue.service.js","line":68,"func":"consume"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Create task","time":"2018-10-16T17:37:37.315Z","src":{"file":"/opt/doc-executor/app/src/services/executor.service.js","line":60,"func":"create"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Creating index","time":"2018-10-16T17:37:37.316Z","src":{"file":"/opt/doc-executor/app/src/services/executor.service.js","line":61,"func":"create"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Creating index index_b00bd94488c64f75bae7ec0bf0fd39d7_1539711457316 and type type in elastic","time":"2018-10-16T17:37:37.316Z","src":{"file":"/opt/doc-executor/app/src/services/elastic.service.js","line":54,"func":"createIndex"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Sending index created message of taskId 2f533c51-9e8d-4bcf-9c9c-06db2392d463 and index index_b00bd94488c64f75bae7ec0bf0fd39d7_1539711457316","time":"2018-10-16T17:37:38.826Z","src":{"file":"/opt/doc-executor/app/src/services/status-queue.service.js","line":56,"func":"sendIndexCreated"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":30,"msg":"Sending message IndexCreatedMessage {\n  id: 'b7e3d110-1247-41c9-aece-909bca78501f',\n  type: 'STATUS_INDEX_CREATED',\n  taskId: '2f533c51-9e8d-4bcf-9c9c-06db2392d463',\n  index: 'index_b00bd94488c64f75bae7ec0bf0fd39d7_1539711457316' }","time":"2018-10-16T17:37:40.828Z","src":{"file":"/opt/doc-executor/app/src/services/status-queue.service.js","line":37,"func":"setInterval"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Starting importing service","time":"2018-10-16T17:37:40.832Z","src":{"file":"/opt/doc-executor/app/src/services/executor.service.js","line":69,"func":"create"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Starting read file","time":"2018-10-16T17:37:40.832Z","src":{"file":"/opt/doc-executor/app/src/services/importer.service.js","line":52,"func":"Promise"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":30,"msg":"Getting converter of type csv and dataPath null and url https://www.apihighways.org/static/hxl.csv","time":"2018-10-16T17:37:40.833Z","src":{"file":"/opt/doc-executor/app/src/services/converters/converterFactory.js","line":10,"func":"getInstance"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Is a url. Downloading file","time":"2018-10-16T17:37:40.833Z","src":{"file":"/opt/doc-executor/app/src/services/converters/csvConverter.js","line":28,"func":"init"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":30,"msg":"Checking if the url https://www.apihighways.org/static/hxl.csv exists","time":"2018-10-16T17:37:40.833Z","src":{"file":"/opt/doc-executor/app/src/services/downloadService.js","line":53,"func":"checkIfExists"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Headers  text/csv; charset=UTF-8 200","time":"2018-10-16T17:37:40.940Z","src":{"file":"/opt/doc-executor/app/src/services/downloadService.js","line":60,"func":"checkIfExists"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Downloading....","time":"2018-10-16T17:37:40.941Z","src":{"file":"/opt/doc-executor/app/src/services/downloadService.js","line":70,"func":"downloadFile"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Temporal path /tmp/MaUsS3OEFhm1OYO37Gy7GwD5iPwotkab.csv . Downloading","time":"2018-10-16T17:37:40.941Z","src":{"file":"/opt/doc-executor/app/src/services/downloadService.js","line":72,"func":"downloadFile"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Sending request","time":"2018-10-16T17:37:40.941Z","src":{"file":"/opt/doc-executor/app/src/services/downloadService.js","line":31},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":30,"msg":"File size: 1.5 KiB","time":"2018-10-16T17:37:40.969Z","src":{"file":"/opt/doc-executor/app/src/services/downloadService.js","line":35,"func":"download.then.data"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Downloaded file!!!","time":"2018-10-16T17:37:40.970Z","src":{"file":"/opt/doc-executor/app/src/services/downloadService.js","line":74,"func":"downloadFile"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"check and format","time":"2018-10-16T17:37:40.970Z","src":{"file":"/opt/doc-executor/app/src/services/converters/csvConverter.js","line":73,"func":"checkAndFormatHXL"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Second filepath","time":"2018-10-16T17:37:40.972Z","src":{"file":"/opt/doc-executor/app/src/services/converters/csvConverter.js","line":55,"func":"serialize"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"/tmp/MaUsS3OEFhm1OYO37Gy7GwD5iPwotkab.csv","time":"2018-10-16T17:37:40.972Z","src":{"file":"/opt/doc-executor/app/src/services/converters/csvConverter.js","line":56,"func":"serialize"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Starting process file","time":"2018-10-16T17:37:40.972Z","src":{"file":"/opt/doc-executor/app/src/services/importer.service.js","line":62,"func":"Promise"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"skip row - has hashes","time":"2018-10-16T17:37:40.977Z","src":{"file":"/opt/doc-executor/app/src/services/importer.service.js","line":187,"func":"processRow"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"[ '#country+name',\n  '#activity+appeal+id+fts_internal',\n  '#activity+appeal+name',\n  '#activity+appeal+id+external',\n  '#date+start',\n  '#date+end',\n  '#date+year',\n  '#value+funding+required+usd',\n  '#value+funding+total+usd',\n  '#value+funding+pct' ]","time":"2018-10-16T17:37:40.977Z","src":{"file":"/opt/doc-executor/app/src/services/converters/csvConverter.js","line":84,"func":"readStream.on"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":30,"msg":"Removing file /tmp/MaUsS3OEFhm1OYO37Gy7GwD5iPwotkab.csv","time":"2018-10-16T17:37:40.980Z","src":{"file":"/opt/doc-executor/app/src/services/converters/csvConverter.js","line":63,"func":"readStream.on"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Body data: 24","time":"2018-10-16T17:37:40.980Z","src":{"file":"/opt/doc-executor/app/src/services/importer.service.js","line":69,"func":"stream.on"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Finishing reading file","time":"2018-10-16T17:37:40.981Z","src":{"file":"/opt/doc-executor/app/src/services/importer.service.js","line":75,"func":"stream.on"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Sending data message (24)","time":"2018-10-16T17:37:40.981Z","src":{"file":"/opt/doc-executor/app/src/services/data-queue.service.js","line":57,"func":"sendDataMessage"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":30,"msg":"Sending message","time":"2018-10-16T17:37:42.983Z","src":{"file":"/opt/doc-executor/app/src/services/data-queue.service.js","line":39,"func":"setInterval"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Sending Read data of taskId 2f533c51-9e8d-4bcf-9c9c-06db2392d463","time":"2018-10-16T17:37:42.985Z","src":{"file":"/opt/doc-executor/app/src/services/status-queue.service.js","line":72,"func":"sendReadData"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":30,"msg":"Sending message ReadDataMessage {\n  id: '725c7162-0376-4c14-880e-2be8b3843101',\n  type: 'STATUS_READ_DATA',\n  taskId: '2f533c51-9e8d-4bcf-9c9c-06db2392d463' }","time":"2018-10-16T17:37:44.988Z","src":{"file":"/opt/doc-executor/app/src/services/status-queue.service.js","line":37,"func":"setInterval"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Pack saved successfully, num: 1","time":"2018-10-16T17:37:44.989Z","src":{"file":"/opt/doc-executor/app/src/services/importer.service.js","line":81,"func":"dataQueueService.sendDataMessage.then"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Sending read file message","time":"2018-10-16T17:37:44.989Z","src":{"file":"/opt/doc-executor/app/src/services/executor.service.js","line":73,"func":"create"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Sending Read File of taskId 2f533c51-9e8d-4bcf-9c9c-06db2392d463","time":"2018-10-16T17:37:44.989Z","src":{"file":"/opt/doc-executor/app/src/services/status-queue.service.js","line":79,"func":"sendReadFile"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":30,"msg":"Sending message ReadFileMessage {\n  id: '150e1753-a499-45e8-8573-47242b741bd4',\n  type: 'STATUS_READ_FILE',\n  taskId: '2f533c51-9e8d-4bcf-9c9c-06db2392d463' }","time":"2018-10-16T17:37:46.991Z","src":{"file":"/opt/doc-executor/app/src/services/status-queue.service.js","line":37,"func":"setInterval"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":30,"msg":"Message processed successfully","time":"2018-10-16T17:37:46.992Z","src":{"file":"/opt/doc-executor/app/src/services/executor-queue.service.js","line":71,"func":"consume"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Message received {\"id\":\"ed9666a0-76a2-467f-917b-58fafa1dddcb\",\"type\":\"EXECUTION_CONFIRM_IMPORT\",\"taskId\":\"2f533c51-9e8d-4bcf-9c9c-06db2392d463\",\"index\":\"index_b00bd94488c64f75bae7ec0bf0fd39d7_1539711457316\"}","time":"2018-10-16T17:37:47.004Z","src":{"file":"/opt/doc-executor/app/src/services/executor-queue.service.js","line":66,"func":"consume"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"message content { id: 'ed9666a0-76a2-467f-917b-58fafa1dddcb',\n  type: 'EXECUTION_CONFIRM_IMPORT',\n  taskId: '2f533c51-9e8d-4bcf-9c9c-06db2392d463',\n  index: 'index_b00bd94488c64f75bae7ec0bf0fd39d7_1539711457316' }","time":"2018-10-16T17:37:47.004Z","src":{"file":"/opt/doc-executor/app/src/services/executor-queue.service.js","line":68,"func":"consume"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Confirming index index_b00bd94488c64f75bae7ec0bf0fd39d7_1539711457316","time":"2018-10-16T17:37:47.004Z","src":{"file":"/opt/doc-executor/app/src/services/executor.service.js","line":167,"func":"confirmImport"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":20,"msg":"Sending Read File of taskId 2f533c51-9e8d-4bcf-9c9c-06db2392d463","time":"2018-10-16T17:37:47.336Z","src":{"file":"/opt/doc-executor/app/src/services/status-queue.service.js","line":86,"func":"sendImportConfirmed"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":30,"msg":"Sending message ImportConfirmedMessage {\n  id: '3ffb6df7-1973-4cdf-aa2f-24c4512b418d',\n  type: 'STATUS_IMPORT_CONFIRMED',\n  taskId: '2f533c51-9e8d-4bcf-9c9c-06db2392d463',\n  lastCheckedDate: 2018-10-16T17:37:47.337Z }","time":"2018-10-16T17:37:49.337Z","src":{"file":"/opt/doc-executor/app/src/services/status-queue.service.js","line":37,"func":"setInterval"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-66b74c6777-dg7xq","pid":17,"level":30,"msg":"Message processed successfully","time":"2018-10-16T17:37:49.338Z","src":{"file":"/opt/doc-executor/app/src/services/executor-queue.service.js","line":71,"func":"consume"},"v":0}
