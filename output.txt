Running Start

> doc-writer@1.0.0 start /opt/doc-executor
> NODE_PATH=app/src node app/index.js

{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":20,"msg":"Initializing doc-executor","time":"2018-10-16T18:36:29.952Z","src":{"file":"/opt/doc-executor/app/src/app.js","line":3},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":30,"msg":"Connecting to queue DOC-STATUS","time":"2018-10-16T18:36:30.025Z","src":{"file":"/opt/doc-executor/app/src/services/status-queue.service.js","line":13,"func":"StatusQueueService"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":30,"msg":"Connecting to queue DOC-DATA","time":"2018-10-16T18:36:30.369Z","src":{"file":"/opt/doc-executor/app/src/services/data-queue.service.js","line":17,"func":"DataQueueService"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":30,"msg":"Connecting to queue DOC-EXECUTOR-TASKS","time":"2018-10-16T18:36:30.600Z","src":{"file":"/opt/doc-executor/app/src/services/executor-queue.service.js","line":20,"func":"ExecutorQueueService"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":30,"msg":"Connected","time":"2018-10-16T18:36:30.665Z","src":{"file":"/opt/doc-executor/app/src/services/data-queue.service.js","line":20,"func":"DataQueueService.init.then"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":30,"msg":"Connected","time":"2018-10-16T18:36:30.665Z","src":{"file":"/opt/doc-executor/app/src/services/status-queue.service.js","line":16,"func":"StatusQueueService.init.then"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":30,"msg":" [*] Waiting for messages in DOC-EXECUTOR-TASKS","time":"2018-10-16T18:36:30.667Z","src":{"file":"/opt/doc-executor/app/src/services/executor-queue.service.js","line":40,"func":"init"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":30,"msg":"Connected","time":"2018-10-16T18:36:30.667Z","src":{"file":"/opt/doc-executor/app/src/services/executor-queue.service.js","line":23,"func":"ExecutorQueueService.init.then"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":20,"msg":"Message received {\"id\":\"bbd45571-421d-4154-a42a-7c86b74dbb2c\",\"type\":\"EXECUTION_CREATE\",\"taskId\":\"9bf8acb3-08ca-4577-b4f9-cc6f56154b75\",\"datasetId\":\"d84a5519-3492-4aa5-aece-cd0a2309c806\",\"fileUrl\":\"https://www.apihighways.org/static/hxl.csv\",\"provider\":\"csv\",\"legend\":{\"nested\":[],\"country\":[],\"region\":[],\"date\":[]},\"verified\":false,\"dataPath\":null}","time":"2018-10-16T18:36:30.670Z","src":{"file":"/opt/doc-executor/app/src/services/executor-queue.service.js","line":66,"func":"consume"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":20,"msg":"message content { id: 'bbd45571-421d-4154-a42a-7c86b74dbb2c',\n  type: 'EXECUTION_CREATE',\n  taskId: '9bf8acb3-08ca-4577-b4f9-cc6f56154b75',\n  datasetId: 'd84a5519-3492-4aa5-aece-cd0a2309c806',\n  fileUrl: 'https://www.apihighways.org/static/hxl.csv',\n  provider: 'csv',\n  legend: { nested: [], country: [], region: [], date: [] },\n  verified: false,\n  dataPath: null }","time":"2018-10-16T18:36:30.670Z","src":{"file":"/opt/doc-executor/app/src/services/executor-queue.service.js","line":68,"func":"consume"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":20,"msg":"Create task","time":"2018-10-16T18:36:30.670Z","src":{"file":"/opt/doc-executor/app/src/services/executor.service.js","line":60,"func":"create"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":20,"msg":"Creating index","time":"2018-10-16T18:36:30.670Z","src":{"file":"/opt/doc-executor/app/src/services/executor.service.js","line":61,"func":"create"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":20,"msg":"Creating index index_d84a551934924aa5aececd0a2309c806_1539714990671 and type type in elastic","time":"2018-10-16T18:36:30.671Z","src":{"file":"/opt/doc-executor/app/src/services/elastic.service.js","line":54,"func":"createIndex"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":20,"msg":"Sending index created message of taskId 9bf8acb3-08ca-4577-b4f9-cc6f56154b75 and index index_d84a551934924aa5aececd0a2309c806_1539714990671","time":"2018-10-16T18:36:32.999Z","src":{"file":"/opt/doc-executor/app/src/services/status-queue.service.js","line":56,"func":"sendIndexCreated"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":30,"msg":"Sending message IndexCreatedMessage {\n  id: '80aa458d-6303-4975-a58e-9a87fbdec579',\n  type: 'STATUS_INDEX_CREATED',\n  taskId: '9bf8acb3-08ca-4577-b4f9-cc6f56154b75',\n  index: 'index_d84a551934924aa5aececd0a2309c806_1539714990671' }","time":"2018-10-16T18:36:35.003Z","src":{"file":"/opt/doc-executor/app/src/services/status-queue.service.js","line":37,"func":"setInterval"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":20,"msg":"Starting importing service","time":"2018-10-16T18:36:35.006Z","src":{"file":"/opt/doc-executor/app/src/services/executor.service.js","line":69,"func":"create"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":20,"msg":"Starting read file","time":"2018-10-16T18:36:35.006Z","src":{"file":"/opt/doc-executor/app/src/services/importer.service.js","line":52,"func":"Promise"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":30,"msg":"Getting converter of type csv and dataPath null and url https://www.apihighways.org/static/hxl.csv","time":"2018-10-16T18:36:35.006Z","src":{"file":"/opt/doc-executor/app/src/services/converters/converterFactory.js","line":10,"func":"getInstance"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":20,"msg":"Is a url. Downloading file","time":"2018-10-16T18:36:35.007Z","src":{"file":"/opt/doc-executor/app/src/services/converters/csvConverter.js","line":28,"func":"init"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":30,"msg":"Checking if the url https://www.apihighways.org/static/hxl.csv exists","time":"2018-10-16T18:36:35.007Z","src":{"file":"/opt/doc-executor/app/src/services/downloadService.js","line":53,"func":"checkIfExists"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":20,"msg":"Headers  text/csv; charset=UTF-8 200","time":"2018-10-16T18:36:35.179Z","src":{"file":"/opt/doc-executor/app/src/services/downloadService.js","line":60,"func":"checkIfExists"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":20,"msg":"Downloading....","time":"2018-10-16T18:36:35.179Z","src":{"file":"/opt/doc-executor/app/src/services/downloadService.js","line":70,"func":"downloadFile"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":20,"msg":"Temporal path /tmp/bMxOczQNQ81AUV2b4WJ7BJUrOj30z2BC.csv . Downloading","time":"2018-10-16T18:36:35.179Z","src":{"file":"/opt/doc-executor/app/src/services/downloadService.js","line":72,"func":"downloadFile"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":20,"msg":"Sending request","time":"2018-10-16T18:36:35.180Z","src":{"file":"/opt/doc-executor/app/src/services/downloadService.js","line":31},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":30,"msg":"File size: 1.5 KiB","time":"2018-10-16T18:36:35.206Z","src":{"file":"/opt/doc-executor/app/src/services/downloadService.js","line":35,"func":"download.then.data"},"v":0}
{"name":"doc-executor","hostname":"doc-executor-sdgs-84b8d48885-l59ng","pid":16,"level":20,"msg":"Downloaded file!!!","time":"2018-10-16T18:36:35.207Z","src":{"file":"/opt/doc-executor/app/src/services/downloadService.js","line":74,"func":"downloadFile"},"v":0}
events.js:193
      throw er; // Unhandled 'error' event
      ^

ReferenceError: rowCount is not defined
    at ParserStream.readStream.on (/opt/doc-executor/app/src/services/converters/csvConverter.js:82:17)
    at emitOne (events.js:125:13)
    at ParserStream.emit (events.js:221:7)
    at spreadArgs (/opt/doc-executor/node_modules/fast-csv/lib/extended.js:43:25)
    at ParserStream.emit (/opt/doc-executor/node_modules/fast-csv/lib/parser/parser_stream.js:325:13)
    at addChunk (_stream_readable.js:265:12)
    at readableAddChunk (_stream_readable.js:252:11)
    at ParserStream.Readable.push (_stream_readable.js:209:10)
    at ParserStream.Transform.push (_stream_transform.js:146:32)
    at ParserStream.__emitRecord (/opt/doc-executor/node_modules/fast-csv/lib/parser/parser_stream.js:202:18)
    at /opt/doc-executor/node_modules/fast-csv/lib/parser/parser_stream.js:96:38
    at /opt/doc-executor/node_modules/fast-csv/lib/parser/parser_stream.js:73:29
    at ParserStream.__validate (/opt/doc-executor/node_modules/fast-csv/lib/parser/parser_stream.js:278:16)
    at /opt/doc-executor/node_modules/fast-csv/lib/parser/parser_stream.js:69:26
    at ParserStream.__transform (/opt/doc-executor/node_modules/fast-csv/lib/parser/parser_stream.js:282:16)
    at ParserStream.__parseLineData [as __handleLine] (/opt/doc-executor/node_modules/fast-csv/lib/parser/parser_stream.js:65:18)
    at /opt/doc-executor/node_modules/fast-csv/lib/parser/parser_stream.js:90:22
    at asyncIterator (/opt/doc-executor/node_modules/fast-csv/lib/extended.js:13:17)
    at Function.asyncEach (/opt/doc-executor/node_modules/fast-csv/lib/extended.js:31:10)
    at ParserStream.__processRows (/opt/doc-executor/node_modules/fast-csv/lib/parser/parser_stream.js:88:18)
    at /opt/doc-executor/node_modules/fast-csv/lib/parser/parser_stream.js:186:34
    at headerHandler (/opt/doc-executor/node_modules/fast-csv/lib/parser/parser_stream.js:157:13)
npm ERR! code ELIFECYCLE
npm ERR! errno 1
npm ERR! doc-writer@1.0.0 start: `NODE_PATH=app/src node app/index.js`
npm ERR! Exit status 1
npm ERR! 
npm ERR! Failed at the doc-writer@1.0.0 start script.
npm ERR! This is probably not a problem with npm. There is likely additional logging output above.

npm ERR! A complete log of this run can be found in:
npm ERR!     /home/doc-executor/.npm/_logs/2018-10-16T18_36_35_221Z-debug.log
